<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Alexis Ortiz Music 270 Final Project</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.7.77/Tone.js"></script>
  <style>
    body { 
      font-family: sans-serif; 
      display: flex; 
      flex-direction: column; 
      align-items: center; 
      padding: 2rem; 
      background-color: #f5f5f5;
    }
    
    .control-buttons {
      display: flex;
      margin: 1rem 0;
    }
    
    .control-btn {
      background-color: #2196F3;
      color: white;
      border: none;
      border-radius: 4px;
      margin: 0 0.5rem;
      padding: 0.8rem 1.5rem;
      font-size: 1.1rem;
      transition: background-color 0.3s;
    }
    
    .control-btn:hover {
      background-color: #0b7dda;
    }
    
    .stop-btn {
      background-color: #f44336;
    }
    
    .stop-btn:hover {
      background-color: #d32f2f;
    }
    
    .sequence-display {
      border: 1px solid #ccc;
      padding: 1rem;
      min-height: 50px;
      width: 90%;
      max-width: 800px;
      margin: 1rem 0;
      border-radius: 4px;
      text-align: center;
      background-color: white;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
      overflow-x: auto;
      white-space: nowrap;
    }
    
    .note-pill {
      display: inline-block;
      background-color: #4CAF50;
      color: white;
      padding: 0.3rem 0.6rem;
      margin: 0.2rem;
      border-radius: 15px;
      font-size: 0.9rem;
    }
    
    /* Piano Keyboard Styling */
    .piano-container {
      position: relative;
      width: 90%;
      max-width: 900px;
      height: 200px;
      margin: 20px auto;
      overflow-x: auto;
      background-color: #222;
      padding: 18px 18px 28px 18px;
      border-radius: 16px;
      box-shadow: 0 6px 24px rgba(0,0,0,0.18);
    }
    
    .piano {
      display: flex;
      height: 170px;
      position: relative;
      margin: 0 auto;
      z-index: 1;
      justify-content: center;
    }
    
    .white-key {
      background: linear-gradient(180deg, #fff 80%, #e0e0e0 100%);
      border: 1.5px solid #bbb;
      width: 38px;
      height: 170px;
      position: relative;
      margin: 0 -2px;
      border-radius: 0 0 6px 6px;
      cursor: pointer;
      z-index: 1;
      box-shadow: 0 2px 6px rgba(0,0,0,0.08);
      transition: background 0.1s, box-shadow 0.1s;
      display: flex;
      align-items: flex-end;
      justify-content: center;
    }
    
    .white-key:hover, .white-key.active {
      background: linear-gradient(180deg, #f8f8f8 60%, #d1eaff 100%);
      box-shadow: 0 4px 16px rgba(33,150,243,0.12);
      border-color: #2196F3;
    }
    
    .black-key {
      background: linear-gradient(180deg, #222 60%, #444 100%);
      width: 22px;
      height: 110px;
      position: absolute;
      margin-left: -11px;
      z-index: 2;
      cursor: pointer;
      border-radius: 0 0 4px 4px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.25);
      border: 1.5px solid #111;
      transition: background 0.1s, box-shadow 0.1s;
      display: flex;
      align-items: flex-end;
      justify-content: center;
    }
    
    .black-key:hover, .black-key.active {
      background: linear-gradient(180deg, #444 40%, #2196F3 100%);
      box-shadow: 0 4px 16px rgba(33,150,243,0.18);
      border-color: #2196F3;
    }
    
    .key-label {
      position: absolute;
      bottom: 8px;
      left: 50%;
      transform: translateX(-50%);
      font-size: 11px;
      color: #888;
      pointer-events: none;
      font-family: monospace;
      background: rgba(255,255,255,0.7);
      padding: 1px 4px;
      border-radius: 6px;
    }
    
    .black-key .key-label {
      color: #fff;
      background: rgba(0,0,0,0.7);
      bottom: 12px;
      font-size: 9px;
    }
    
    .octave-label {
      position: absolute;
      bottom: -22px;
      left: 50%;
      transform: translateX(-50%);
      font-size: 13px;
      color: #fff;
      font-family: monospace;
      background: rgba(33,33,33,0.7);
      padding: 2px 10px;
      border-radius: 8px;
      z-index: 3;
      pointer-events: none;
      box-shadow: 0 1px 4px rgba(0,0,0,0.12);
    }
    
    .tempo-control {
      display: flex;
      flex-direction: column;
      align-items: center;
      margin: 1.5rem 0;
      background-color: white;
      padding: 1rem;
      border-radius: 8px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
      width: 90%;
      max-width: 500px;
    }
    
    .tempo-control label {
      margin-bottom: 0.8rem;
      font-size: 1.1rem;
      font-weight: 500;
    }
    
    #tempo-slider {
      width: 100%;
      height: 6px;
      background: #e0e0e0;
      outline: none;
      border-radius: 3px;
      cursor: pointer;
      -webkit-appearance: none;
    }
    
    #tempo-slider::-webkit-slider-thumb {
      -webkit-appearance: none;
      appearance: none;
      width: 22px;
      height: 22px;
      border-radius: 50%;
      background: #2196F3;
      cursor: pointer;
      transition: background 0.2s;
      border: 2px solid white;
      box-shadow: 0 2px 5px rgba(0,0,0,0.2);
    }
    
    #tempo-slider::-moz-range-thumb {
      width: 22px;
      height: 22px;
      border-radius: 50%;
      background: #2196F3;
      cursor: pointer;
      transition: background 0.2s;
      border: 2px solid white;
      box-shadow: 0 2px 5px rgba(0,0,0,0.2);
    }
    
    #tempo-slider::-webkit-slider-thumb:hover,
    #tempo-slider::-moz-range-thumb:hover {
      background: #0b7dda;
    }
    
    #tempo-value {
      font-weight: bold;
      color: #2196F3;
    }
    
    .speed-label {
      margin-top: 10px;
      font-size: 0.9rem;
      color: #666;
      padding: 5px 10px;
      background-color: #f5f5f5;
      border-radius: 4px;
    }
    
    #speed-description {
      font-weight: bold;
      color: #4CAF50;
    }
    
    /* Animation for extreme tempos */
    @keyframes shake {
      0% { transform: translate(1px, 1px) rotate(0deg); }
      10% { transform: translate(-1px, -2px) rotate(-1deg); }
      20% { transform: translate(-3px, 0px) rotate(1deg); }
      30% { transform: translate(3px, 2px) rotate(0deg); }
      40% { transform: translate(1px, -1px) rotate(1deg); }
      50% { transform: translate(-1px, 2px) rotate(-1deg); }
      60% { transform: translate(-3px, 1px) rotate(0deg); }
      70% { transform: translate(3px, 1px) rotate(-1deg); }
      80% { transform: translate(-1px, -1px) rotate(1deg); }
      90% { transform: translate(1px, 2px) rotate(0deg); }
      100% { transform: translate(1px, -2px) rotate(-1deg); }
    }
    
    @keyframes colorChange {
      0% { color: #FF0000; }
      20% { color: #FF9900; }
      40% { color: #FFFF00; }
      60% { color: #00FF00; }
      80% { color: #0000FF; }
      100% { color: #FF00FF; }
    }
  </style>
</head>
<body>
  <h1>Alexis Ortiz Music 270 Final Project</h1>
  <div class="piano-container">
    <div class="piano" id="piano-keyboard">
    </div>
  </div>
  <div class="sequence-display" id="sequence-display">
    <p id="empty-message">Click piano keys to add notes to the sequence</p>
  </div>
  <div class="control-buttons">
    <button class="control-btn" onclick="Tone.start().then(startSequence)">Play Sequence</button>
    <button class="control-btn stop-btn" onclick="stopSequence()">Stop</button>
    <button class="control-btn" onclick="clearSequence()">Clear</button>
  </div>
  
  <div class="tempo-control">
    <label for="tempo-slider">Tempo: <span id="tempo-value">120</span> BPM</label>
    <input type="range" id="tempo-slider" min="40" max="1000" value="120" step="1">
    <div class="speed-label">Speed: <span id="speed-description">Normal</span></div>
  </div>
  
  <script>
    const synth = new Tone.Synth().toDestination();
    let noteSequence = [];
    let sequencePlayer = null;
    // Notes configuration for a 3-octave piano (C3 to B5)
    const octaves = [3, 4, 5];
    const whiteNotes = ['C', 'D', 'E', 'F', 'G', 'A', 'B'];
    let tempo = 120; // Default tempo in BPM
    
    function createPianoKeyboard() {
      const pianoElement = document.getElementById('piano-keyboard');
      pianoElement.innerHTML = '';
      let keyIndex = 0;
      const totalWhiteKeys = octaves.length * whiteNotes.length;
      const whiteKeyWidth = 38;
      // Calculate total width of all white keys
      const totalWidth = totalWhiteKeys * whiteKeyWidth;
      // Center the keys by adding a wrapper
      const keysWrapper = document.createElement('div');
      keysWrapper.style.position = 'relative';
      keysWrapper.style.width = totalWidth + 'px';
      keysWrapper.style.margin = '0 auto';
      keysWrapper.style.height = '170px';
      pianoElement.appendChild(keysWrapper);
      octaves.forEach(octave => {
        whiteNotes.forEach((note, i) => {
          const whiteKey = document.createElement('div');
          whiteKey.className = 'white-key';
          whiteKey.setAttribute('data-note', `${note}${octave}`);
          whiteKey.style.position = 'relative';
          whiteKey.style.display = 'inline-flex';
          whiteKey.style.verticalAlign = 'bottom';
          const keyLabel = document.createElement('div');
          keyLabel.className = 'key-label';
          keyLabel.textContent = `${note}${octave}`;
          whiteKey.appendChild(keyLabel);
          whiteKey.addEventListener('click', function() {
            const noteName = this.getAttribute('data-note');
            playAndAddToSequence(noteName);
            this.classList.add('active');
            setTimeout(() => this.classList.remove('active'), 300);
          });
          keysWrapper.appendChild(whiteKey);
          // Add black keys
          if (['C', 'D', 'F', 'G', 'A'].includes(note) && i < whiteNotes.length - 1) {
            const blackNote = note + '#';
            const blackKey = document.createElement('div');
            blackKey.className = 'black-key';
            blackKey.setAttribute('data-note', `${blackNote}${octave}`);
            blackKey.style.position = 'absolute';
            // Calculate left offset relative to the wrapper
            blackKey.style.left = `${(keyIndex + 1) * whiteKeyWidth - 11}px`;
            blackKey.style.top = '0';
            const blackKeyLabel = document.createElement('div');
            blackKeyLabel.className = 'key-label';
            blackKeyLabel.textContent = `${blackNote}${octave}`;
            blackKey.appendChild(blackKeyLabel);
            blackKey.addEventListener('click', function() {
              const noteName = this.getAttribute('data-note');
              playAndAddToSequence(noteName);
              this.classList.add('active');
              setTimeout(() => this.classList.remove('active'), 300);
            });
            keysWrapper.appendChild(blackKey);
          }
          keyIndex++;
        });
      });
      // Add octave labels
      let octaveStart = 0;
      octaves.forEach((octave, idx) => {
        const octaveLabel = document.createElement('div');
        octaveLabel.className = 'octave-label';
        octaveLabel.textContent = `Octave ${octave}`;
        octaveLabel.style.left = `${(octaveStart + 3.5) * whiteKeyWidth}px`;
        keysWrapper.appendChild(octaveLabel);
        octaveStart += 7;
      });
    }
    function updateTempo(value) {
      tempo = value;
      document.getElementById('tempo-value').textContent = tempo;
      Tone.Transport.bpm.value = tempo;
      
      // Update speed description without applying animations immediately
      const speedDescription = document.getElementById('speed-description');
      if (tempo < 60) {
        speedDescription.textContent = 'Very Slow';
      } else if (tempo < 90) {
        speedDescription.textContent = 'Slow';
      } else if (tempo < 110) {
        speedDescription.textContent = 'Moderate';
      } else if (tempo < 140) {
        speedDescription.textContent = 'Normal';
      } else if (tempo < 180) {
        speedDescription.textContent = 'Fast';
      } else if (tempo < 300) {
        speedDescription.textContent = 'Very Fast';
      } else if (tempo < 500) {
        speedDescription.textContent = 'Ridiculous';
      } else if (tempo < 700) {
        speedDescription.textContent = 'Is This Even Music?';
      } else if (tempo < 900) {
        speedDescription.textContent = 'My Ears Are Bleeding';
      } else {
        speedDescription.textContent = 'Ludicrous Speed!';
      }
      
      // If the sequence is already playing, apply the animations
      if (Tone.Transport.state === "started") {
        applyTempoAnimations();
      }
    }
    
    // New function to apply animations based on tempo
    function applyTempoAnimations() {
      const speedDescription = document.getElementById('speed-description');
      
      // Reset animations first
      document.body.style.animation = '';
      speedDescription.style.animation = '';
      
      // Apply animations only for extreme tempos
      if (tempo >= 300 && tempo < 500) {
        document.body.style.animation = 'shake 0.5s infinite';
      } else if (tempo >= 500 && tempo < 700) {
        document.body.style.animation = 'shake 0.3s infinite';
        speedDescription.style.animation = 'colorChange 1s infinite';
      } else if (tempo >= 700 && tempo < 900) {
        document.body.style.animation = 'shake 0.2s infinite';
        speedDescription.style.animation = 'colorChange 0.5s infinite';
      } else if (tempo >= 900) {
        document.body.style.animation = 'shake 0.1s infinite';
        speedDescription.style.animation = 'colorChange 0.3s infinite';
      }
    }
    
    // Function to remove all animations
    function removeTempoAnimations() {
      document.body.style.animation = '';
      document.getElementById('speed-description').style.animation = '';
    }
    
    function playAndAddToSequence(note) {
      Tone.start();
      synth.triggerAttackRelease(note, "8n");
      noteSequence.push(note);
      updateSequenceDisplay();
      if (Tone.Transport.state === "started") {
        // If playing, update the sequence live
        startSequence();
      }
    }
    function updateSequenceDisplay() {
      const display = document.getElementById("sequence-display");
      const emptyMessage = document.getElementById("empty-message");
      if (noteSequence.length > 0) {
        if (emptyMessage) emptyMessage.remove();
        display.innerHTML = "";
        noteSequence.forEach((note) => {
          const pill = document.createElement("span");
          pill.className = "note-pill";
          pill.textContent = note;
          display.appendChild(pill);
        });
      } else {
        display.innerHTML = "<p id='empty-message'>Click piano keys to add notes to the sequence</p>";
      }
    }
    function startSequence() {
      if (noteSequence.length === 0) {
        alert("Add some notes to the sequence first!");
        return;
      }
      Tone.Transport.stop();
      Tone.Transport.position = 0;
      Tone.Transport.cancel(0);
      if (sequencePlayer) {
        sequencePlayer.stop();
      }
      
      // Set the tempo
      Tone.Transport.bpm.value = tempo;
      
      // Calculate note duration based on tempo
      const noteDuration = 60/tempo + 'n';
      
      sequencePlayer = new Tone.Sequence((time, note) => {
        synth.triggerAttackRelease(note, noteDuration, time);
        const key = document.querySelector(`[data-note="${note}"]`);
        if (key) {
          key.classList.add('active');
          setTimeout(() => key.classList.remove('active'), 150);
        }
      }, noteSequence, '4n').start(0);
      
      Tone.Transport.start();
      
      // Apply animations only after playback has started
      applyTempoAnimations();
    }
    function stopSequence() {
      Tone.Transport.stop();
      Tone.Transport.position = 0;
      if (sequencePlayer) {
        sequencePlayer.stop();
      }
      
      // Remove animations when stopped
      removeTempoAnimations();
    }
    function clearSequence() {
      stopSequence();
      noteSequence = [];
      updateSequenceDisplay();
      // Make sure animations are removed when clearing sequence
      removeTempoAnimations();
    }
    window.onload = function() {
      createPianoKeyboard();
      
      // Set up tempo slider
      const tempoSlider = document.getElementById('tempo-slider');
      tempoSlider.addEventListener('input', function() {
        updateTempo(parseInt(this.value));
      });
      updateTempo(tempo); // Initialize with default value
    };
  </script>
</body>
</html>

